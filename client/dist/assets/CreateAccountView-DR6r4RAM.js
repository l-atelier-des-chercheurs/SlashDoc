import{n as _}from"../build.js";const u={components:{},data(){return{authors:[],new_author_email:"",new_author_first_name:"",new_author_last_name:"",new_author_password:"",new_author_cover_raw:void 0,is_creating_author:!1,error_msg:"",can_create_author:!1,submitted_signup_password:"",is_submitting_signup_password:!1,account_created_notice:!1,terms_accepted:!1,email_valid:!1,first_name_valid:!1,last_name_valid:!1}},async mounted(){const a=await this.$api.getFolders({path:"authors"});this.authors=a},computed:{is_first_user(){return!this.authors||this.authors.length===0},signup_password(){return this.$root.app_infos.instance_meta.signup_password_hashed},combined_name(){const a=[];return this.new_author_first_name.trim()&&a.push(this.new_author_first_name.trim()),this.new_author_last_name.trim()&&a.push(this.new_author_last_name.trim()),a.join(" ")||this.new_author_first_name||""}},methods:{goToLogin(){this.$router.push("/login")},checkValidity(a){},async createAuthor(){if(!this.combined_name.trim()){this.$alertify.delay(4e3).error(this.$t("name")+" "+this.$t("required"));return}this.is_creating_author=!0;try{const a=Math.random().toString(36).slice(2)+Math.random().toString(36).slice(2),t=await this.$api.createFolder({path:"authors",additional_meta:{email:this.new_author_email,name:this.combined_name,requested_slug:this.combined_name,$status:"public",$password:a}});this.$alertify.delay(4e3).success(this.$t("account_created")),this.connected_as?(this.account_created_notice=!0,setTimeout(()=>{this.account_created_notice=!1},3e3)):await this.$api.loginToFolder({path:"authors/"+t,password:a}),this.is_instance_admin||(window.location.href="/onboarding")}catch(a){a.code==="unique_field_taken"?this.$alertify.delay(4e3).error(this.$t("name_taken")+" : "+a.err_infos):this.$alertify.delay(4e3).error(a.message||"error:")}this.is_creating_author=!1},hashCode(a){return""+a.split("").reduce(function(t,e){return t=(t<<5)-t+e.charCodeAt(0),t&t},0)}}};var l=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_createAccountView"},[e("div",{staticClass:"_createAccountView--content"},[e("form",{staticClass:"input-validation-required _createAccountForm",on:{submit:function(s){return s.preventDefault(),t.createAuthor.apply(null,arguments)}}},[e("h1",{staticClass:"_createAccountView--title"},[t._v(" "+t._s(t.$t("join_slashdoc"))+" ")]),e("div",{staticClass:"_createAccountView--divider"}),e("h2",{staticClass:"_createAccountView--instruction"},[t._v(" "+t._s(t.$t("recommend_org_email"))+" ")]),e("div",{staticClass:"_createAccountView--fields"},[e("div",{staticClass:"_createAccountView--field"},[e("TextInput",{attrs:{content:t.new_author_email,label_str:"email",required:t.$root.app_infos.instance_meta.require_mail_to_signup,input_type:"email",autocomplete:"email"},on:{"update:content":function(s){t.new_author_email=s},toggleValidity:s=>t.email_valid=s}})],1),e("div",{staticClass:"_createAccountView--field"},[e("TextInput",{attrs:{content:t.new_author_last_name,label_str:"last_name",required:!0,autocomplete:"family-name"},on:{"update:content":function(s){t.new_author_last_name=s},toggleValidity:t.checkValidity}})],1),e("div",{staticClass:"_createAccountView--field"},[e("TextInput",{attrs:{content:t.new_author_first_name,label_str:"first_name",required:!0,autofocus:!0,autocomplete:"given-name"},on:{"update:content":function(s){t.new_author_first_name=s},toggleValidity:t.checkValidity}})],1)]),e("div",{staticClass:"_createAccountView--terms"},[e("label",{staticClass:"_createAccountView--termsLabel"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.terms_accepted,expression:"terms_accepted"}],staticClass:"_createAccountView--checkbox",attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.terms_accepted)?t._i(t.terms_accepted,null)>-1:t.terms_accepted},on:{change:function(s){var i=t.terms_accepted,c=s.target,o=!!c.checked;if(Array.isArray(i)){var n=null,r=t._i(i,n);c.checked?r<0&&(t.terms_accepted=i.concat([n])):r>-1&&(t.terms_accepted=i.slice(0,r).concat(i.slice(r+1)))}else t.terms_accepted=o}}}),e("span",{staticClass:"_createAccountView--termsText"},[t._v(" "+t._s(t.$t("accept_terms_text_start"))+" "),e("router-link",{staticClass:"_createAccountView--termsLink",attrs:{to:"/terms"}},[t._v(" "+t._s(t.$t("terms_of_use_of_slashdoc"))+" ")]),t._v(" "+t._s(t.$t("accept_terms_text_middle"))+" "),e("router-link",{staticClass:"_createAccountView--termsLink",attrs:{to:"/confidentiality"}},[t._v(" "+t._s(t.$t("privacy_policy_of_slashdoc"))+" ")]),t._v(" "+t._s(t.$t("accept_terms_text_end"))+" ")],1)])]),e("button",{staticClass:"u-button u-button_orange _createAccountView--submitButton",class:{"is--loading":t.is_creating_author},attrs:{type:"submit",disabled:t.terms_accepted===!1}},[t.is_creating_author?e("LoaderSpinner"):[t._v(t._s(t.$t("accept_and_signup")))]],2)]),t.account_created_notice?e("div",{staticClass:"u-successMsg"},[t._v(" "+t._s(t.$t("account_created"))+" ")]):t._e(),e("div",{staticClass:"_createAccountView--footer"},[e("router-link",{staticClass:"u-buttonLink",attrs:{to:"/login"}},[e("b-icon",{attrs:{icon:"arrow-left-short"}}),t._v(" "+t._s(t.$t("back"))+" ")],1)],1)])])},d=[],m=_(u,l,d,!1,null,"64e91cdd");const p=m.exports;export{p as default};
