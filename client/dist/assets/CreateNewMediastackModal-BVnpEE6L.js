import{C as c}from"./ContributeView-DYoQYZVt.js";import{n}from"../build.js";import{K as l,a as d}from"./KeywordsField-DORvuQta.js";import{D as p}from"./DestinationCorpusSelector-DH0vsgmG.js";import"./EmbedPicker-D-ofHmFh.js";import"./FileShown-CFPswb_-.js";import"./TwoColumnLayout-CuQ9CwIf.js";const u={name:"MediastackStepTitle",props:{title:{type:String,default:""},description:{type:String,default:""}},methods:{onTitleChange(a){this.$emit("update:title",a)},onDescriptionChange(a){this.$emit("update:description",a)},onTitleValidityChange(a){this.$emit("title-validity-changed",a)}}};var h=function(){var t=this,e=t._self._c;return e("div",[t._t("uptop"),e("div",{staticClass:"u-spacingBottom"}),e("div",{staticClass:"_form-title"},[e("div",{staticClass:"u-spacingBottom"},[e("DLabel",{attrs:{str:t.$t("title")}}),e("TextInput",{attrs:{content:t.title,required:!0,placeholder:t.$t("document_title"),autofocus:!0,can_edit:!0},on:{"update:content":t.onTitleChange,toggleValidity:t.onTitleValidityChange}})],1),e("div",{staticClass:"u-spacingBottom _description"},[e("DLabel",{attrs:{str:t.$t("description")}}),e("TextInput",{attrs:{content:t.description,input_type:"editor",placeholder:t.$t("description_placeholder"),can_edit:!0},on:{"update:content":t.onDescriptionChange}})],1)])],2)},m=[],f=n(u,h,m,!1,null,"28c25c8a");const v=f.exports,$={name:"MediastackStepCredits",props:{selected_items:{type:Array,default:()=>[]},general_credit:{type:String,default:""}},computed:{local_general_credit:{get(){return this.general_credit},set(a){this.$emit("update:general_credit",a)}}},components:{ChutierItem:c},methods:{}};var k=function(){var t=this,e=t._self._c;return e("div",{staticClass:"u-spacingBottom _form-credits"},[e("DLabel",{staticClass:"_label",attrs:{str:t.$t("general_credit"),icon_name:"c-circle"}}),e("div",{staticClass:"u-instructions"},[e("small",[t._v(" "+t._s(t.$t("general_credit_instructions"))+" ")])]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.local_general_credit,expression:"local_general_credit"}],attrs:{type:"text",autofocus:""},domProps:{value:t.local_general_credit},on:{input:function(s){s.target.composing||(t.local_general_credit=s.target.value)}}}),e("div",{staticClass:"u-spacingBottom"}),t.selected_items&&t.selected_items.length?e("div",{staticClass:"_thumbGrid"},t._l(t.selected_items,function(s){return e("ChutierItem",{key:s.$path,staticClass:"_thumbCell",attrs:{file:s,credit_placeholder:t.local_general_credit,is_selected:!1,context:"credits"}})}),1):t._e()],1)},g=[],y=n($,k,g,!1,null,"4d336a57");const b=y.exports,w={name:"MediastackStepKeywords",components:{KeywordsFieldEditor:l},props:{keywords:{type:Array,default:()=>[]}},methods:{onKeywordsChange(a){this.$emit("update:keywords",a)}}};var C=function(){var t=this,e=t._self._c;return e("div",{staticClass:"u-spacingBottom _form-tags"},[e("KeywordsFieldEditor",{attrs:{keywords:t.keywords},on:{"update:keywords":t.onKeywordsChange}})],1)},S=[],M=n(w,C,S,!1,null,"76c0f3dd");const T=M.exports,x={name:"MediastackStepAuthors",components:{DestinationCorpusSelector:p},props:{authors:{type:Array,default:()=>[]},destination_folder_path:{type:[String,void 0],default:void 0}},data(){return{local_destination_folder_path:this.destination_folder_path}},watch:{destination_folder_path:{immediate:!0,handler(a){this.local_destination_folder_path=a}},local_destination_folder_path(a){this.$emit("update:destination_folder_path",a)}},methods:{onAuthorsChange(a){this.$emit("update:authors",a)}}};var F=function(){var t=this,e=t._self._c;return e("div",{staticClass:"u-spacingBottom _form-team"},[e("div",{staticClass:"u-spacingBottom"},[e("DLabel",{attrs:{str:t.$t("archiving_community")}}),e("DestinationCorpusSelector",{attrs:{selected_destination_folder_path:t.local_destination_folder_path},on:{"update:selected_destination_folder_path":function(s){t.local_destination_folder_path=s}}})],1),e("AuthorField",{attrs:{label:t.$t("authors"),instructions:t.$t("content_editing_instructions"),authors_paths:t.authors,disable_links:!0,can_edit:!0},on:{save:t.onAuthorsChange}})],1)},D=[],A=n(x,F,D,!1,null,"58e23159");const B=A.exports,R={name:"MediastackStepReview",components:{KeywordsField:d},props:{title:{type:String,default:""},description:{type:String,default:""},keywords:{type:Array,default:()=>[]},selected_destination_folder_path:{type:String,default:""},authors:{type:Array,default:()=>[]}},data(){return{selected_folder:null}},async created(){this.selected_destination_folder_path&&(this.selected_folder=await this.$api.getFolder({path:this.selected_destination_folder_path}))}};var K=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_form-review"},[e("div",{staticClass:"u-spacingBottom"},[e("h1",[t._v(" "+t._s(t.title||t.$t("none"))+" ")])]),e("div",{staticClass:"u-spacingBottom"},[e("DLabel",{attrs:{str:t.$t("description")}}),e("div",{domProps:{innerHTML:t._s(t.description||t.$t("none_f"))}})],1),e("div",{staticClass:"u-spacingBottom"},[e("DLabel",{attrs:{str:t.$t("keywords")}}),t.keywords.length>0?e("div",[e("KeywordsField",{attrs:{keywords:t.keywords,can_edit:!1}})],1):e("div",[t._v(t._s(t.$t("none")))])],1),e("div",{staticClass:"u-spacingBottom"},[e("DLabel",{attrs:{str:t.$t("destination_corpus")}}),t.selected_folder?e("b",[t._v(" "+t._s(t.selected_folder.title)+" ")]):e("div",[t._v(t._s(t.$t("none")))])],1),e("div",{},[e("DLabel",{attrs:{str:t.$t("authors")}}),t.authors.length>0?e("div",[e("AuthorField",{attrs:{authors_paths:t.authors,disable_links:!0,can_edit:!1}})],1):e("div",[t._v(t._s(t.$t("none")))])],1)])},I=[],L=n(R,K,I,!1,null,"c4d6c8c7");const V=L.exports,P={props:{selected_items:Array},components:{ChutierItem:c,MediastackStepTitle:v,MediastackStepCredits:b,MediastackStepKeywords:T,MediastackStepAuthors:B,MediastackStepReview:V},data(){return{current_step:0,steps:[{label:this.$t("title")},{label:this.$t("credit")},{label:this.$t("keywords")},{label:this.$t("archiving_community")},{label:this.$t("review")}],stack_title:"",has_valid_title:!1,stack_description:"",stack_common_credit:"",stack_general_credit:"",stack_tags:[],stack_authors:[],status:"idle",selected_destination_folder_path:void 0}},created(){this.connected_as.$path&&this.stack_authors.push(this.connected_as.$path)},mounted(){},beforeDestroy(){},watch:{},computed:{modal_size(){return this.current_step===2?"full":"small"},modal_name(){return this.$t("create_document")},allow_next_step(){return this.current_step===0?this.has_valid_title:this.current_step===2?this.stack_tags.length>0:!0},show_only_thumbs(){return this.current_step>0&&this.current_step!==4}},methods:{backStep(){this.current_step>0?this.current_step--:this.$emit("close")},async nextStep(){this.current_step===1&&this.stack_general_credit&&await this.applyGeneralCreditToItems(),this.current_step++},async applyGeneralCreditToItems(){for(const a of this.selected_items)if(!a.$credits||a.$credits.trim()==="")try{await this.$api.updateMeta({path:a.$path,new_meta:{$credits:this.stack_general_credit}}),a.$credits=this.stack_general_credit}catch(t){console.error(`Failed to update credit for ${a.$path}:`,t)}},async publishMediastack(){this.status="publishing";const a=this.selected_destination_folder_path+"/stacks";let t={$status:"public",requested_slug:"stack",$admins:this.stack_authors,title:this.stack_title,description:this.stack_description,keywords:this.stack_tags};const e=await this.$api.createFolder({path:a,additional_meta:t}),s=a+"/"+e;let i=[];for(const r of this.selected_items){const _=await this.$api.copyFile({path:r.$path,path_to_destination_folder:s,new_meta:{}});i.push(_),await this.$api.deleteItem({path:r.$path})}let o={stack_files_metas:i};i.length>=1&&(o.$preview=i[0]),await this.$api.updateMeta({path:s,new_meta:o}),await new Promise(r=>setTimeout(r,250)),this.status="completed",this.$emit("stackPosted",e),await new Promise(r=>setTimeout(r,1e3)),this.$emit("close")}}};var z=function(){var t=this,e=t._self._c;return e("BaseModal2",{attrs:{size:t.modal_size,confirm_before_closing:!0,title:t.current_step===4?t.$t("review"):void 0},on:{save:function(s){},close:function(s){return t.$emit("close")}},scopedSlots:t._u([{key:"footer",fn:function(){return[e("div",[t.status==="idle"?e("button",{staticClass:"u-button u-button_transparent",on:{click:t.backStep}},[e("b-icon",{attrs:{icon:"arrow-left"}}),t._v(" "+t._s(t.$t("back"))+" ")],1):t._e()]),t.current_step<t.steps.length-1?e("button",{staticClass:"u-button",attrs:{disabled:!t.allow_next_step},on:{click:t.nextStep}},[t._v(" "+t._s(t.$t("next"))+" "),e("b-icon",{attrs:{icon:"arrow-right"}})],1):t.current_step===t.steps.length-1&&t.status==="idle"?e("button",{staticClass:"u-button u-button_bleuvert",on:{click:t.publishMediastack}},[e("b-icon",{attrs:{icon:"check-circle-fill"}}),t._v(" "+t._s(t.$t("contribute"))+" ")],1):t.status==="publishing"?e("span",[t._v(" "+t._s(t.$t("publishing"))+" ")]):t.status==="completed"?e("span",[t._v(" "+t._s(t.$t("completed"))+" ")]):t._e(),t.allow_next_step?t._e():e("div",{staticClass:"u-instructions _cantNextInstr"},[t.current_step===0?[t._v(" "+t._s(t.$t("add_title_to_continue"))+" ")]:t._e(),t.current_step===2?[t._v(" "+t._s(t.$t("add_keywords_to_continue"))+" ")]:t._e(),t.current_step===3?[t._v(" "+t._s(t.$t("add_authors_to_continue"))+" ")]:t._e()],2)]},proxy:!0}])},[e("div",{staticClass:"_createNewMediastackModal"},[e("portal-target",{attrs:{name:"largemedia",multiple:""}}),e("div",{staticClass:"_content"},[t.current_step<4?e("div",{staticClass:"_breadcrumb"},t._l(t.steps,function(s,i){return e("button",{key:s.label,staticClass:"step",class:t.current_step===i?"active":t.current_step>i?"completed":"",attrs:{type:"button",title:s.label},on:{click:function(o){t.current_step=i}}},[i>0?e("div",{staticClass:"step-line"}):t._e(),e("div",{staticClass:"step-circle"},[t.current_step>=i?e("div",{staticClass:"step-label"},[t._v(" "+t._s(s.label)+" ")]):t._e()])])}),0):t._e(),e("div",{key:t.current_step,staticClass:"_form"},[t._e(),[0,2,3,4].includes(t.current_step)?e("div",{staticClass:"_uptopThumbs"},[t.selected_items&&t.selected_items.length?e("div",{staticClass:"_thumbGrid"},t._l(t.selected_items,function(s){return e("ChutierItem",{key:s.$path,staticClass:"_thumbCell",attrs:{file:s,context:"show_only_thumbs",is_selected:!1}})}),1):t._e()]):t._e(),t.current_step===0?e("MediastackStepTitle",{attrs:{title:t.stack_title,description:t.stack_description},on:{"update:title":function(s){t.stack_title=s},"update:description":function(s){t.stack_description=s},"title-validity-changed":function(s){t.has_valid_title=s}}}):t._e(),t.current_step===1?e("MediastackStepCredits",{attrs:{selected_items:t.selected_items,general_credit:t.stack_general_credit},on:{"update:general_credit":function(s){t.stack_general_credit=s}}}):t._e(),t.current_step===2?e("MediastackStepKeywords",{attrs:{keywords:t.stack_tags},on:{"update:keywords":function(s){t.stack_tags=s}}}):t._e(),t.current_step===3?e("MediastackStepAuthors",{attrs:{authors:t.stack_authors,destination_folder_path:t.selected_destination_folder_path},on:{"update:authors":function(s){t.stack_authors=s},"update:destination_folder_path":function(s){t.selected_destination_folder_path=s}}}):t._e(),t.current_step===4?e("MediastackStepReview",{attrs:{title:t.stack_title,description:t.stack_description,keywords:t.stack_tags,selected_destination_folder_path:t.selected_destination_folder_path,authors:t.stack_authors}}):t._e()],1)])],1)])},G=[],N=n(P,z,G,!1,null,"fb60e86b");const J=N.exports;export{J as default};
