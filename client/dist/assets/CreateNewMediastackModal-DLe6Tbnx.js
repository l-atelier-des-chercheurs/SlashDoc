import{C as c}from"./ContributeView-CT8aB9wW.js";import{n}from"../build.js";import{K as d,a as l}from"./KeywordsField-yy3dmGzx.js";import{D as p}from"./DestinationCorpusSelector-DH0vsgmG.js";import"./EmbedPicker-D-ofHmFh.js";import"./FileShown-B1Jmpoyt.js";import"./TwoColumnLayout-Bnbkapph.js";const u={name:"MediastackStepTitle",props:{title:{type:String,default:""},description:{type:String,default:""}},methods:{onTitleChange(a){this.$emit("update:title",a)},onDescriptionChange(a){this.$emit("update:description",a)},onTitleValidityChange(a){this.$emit("title-validity-changed",a)}}};var h=function(){var t=this,e=t._self._c;return e("div",[t._t("uptop"),e("div",{staticClass:"u-spacingBottom"}),e("div",{staticClass:"_form-title"},[e("div",{staticClass:"u-spacingBottom"},[e("DLabel",{attrs:{str:t.$t("title")}}),e("TextInput",{attrs:{content:t.title,required:!0,placeholder:t.$t("document_title"),autofocus:!0,can_edit:!0},on:{"update:content":t.onTitleChange,toggleValidity:t.onTitleValidityChange}})],1),e("div",{staticClass:"u-spacingBottom _description"},[e("DLabel",{attrs:{str:t.$t("description")}}),e("TextInput",{attrs:{content:t.description,input_type:"editor",placeholder:t.$t("description_placeholder"),can_edit:!0},on:{"update:content":t.onDescriptionChange}})],1)])],2)},m=[],f=n(u,h,m,!1,null,"28c25c8a");const v=f.exports,$={name:"MediastackStepCredits",props:{selected_items:{type:Array,default:()=>[]},general_credit:{type:String,default:""}},computed:{localGeneralCredit:{get(){return this.general_credit},set(a){this.$emit("update:general_credit",a)}}},components:{ChutierItem:c},methods:{}};var k=function(){var t=this,e=t._self._c;return e("div",{staticClass:"u-spacingBottom _form-credits"},[e("DLabel",{attrs:{str:t.$t("general_credit"),icon_name:"c-circle"}}),e("input",{directives:[{name:"model",rawName:"v-model",value:t.localGeneralCredit,expression:"localGeneralCredit"}],attrs:{type:"text"},domProps:{value:t.localGeneralCredit},on:{input:function(s){s.target.composing||(t.localGeneralCredit=s.target.value)}}}),e("div",{staticClass:"u-spacingBottom u-instructions"},[t._v(" "+t._s(t.$t("general_credit_instructions"))+" ")]),t.selected_items&&t.selected_items.length?e("div",{staticClass:"_thumbGrid"},t._l(t.selected_items,function(s){return e("ChutierItem",{key:s.$path,staticClass:"_thumbCell",attrs:{file:s,is_selected:!1}})}),1):t._e()],1)},g=[],y=n($,k,g,!1,null,"3ecf055f");const C=y.exports,w={name:"MediastackStepKeywords",components:{KeywordsFieldEditor:d},props:{keywords:{type:Array,default:()=>[]}},methods:{onKeywordsChange(a){this.$emit("update:keywords",a)}}};var b=function(){var t=this,e=t._self._c;return e("div",{staticClass:"u-spacingBottom _form-tags"},[e("KeywordsFieldEditor",{attrs:{keywords:t.keywords},on:{"update:keywords":t.onKeywordsChange}})],1)},S=[],M=n(w,b,S,!1,null,"76c0f3dd");const x=M.exports,T={name:"MediastackStepAuthors",components:{DestinationCorpusSelector:p},props:{authors:{type:Array,default:()=>[]},destination_folder_path:{type:[String,void 0],default:void 0}},data(){return{local_destination_folder_path:this.destination_folder_path}},watch:{destination_folder_path:{immediate:!0,handler(a){this.local_destination_folder_path=a}},local_destination_folder_path(a){this.$emit("update:destination_folder_path",a)}},methods:{onAuthorsChange(a){this.$emit("update:authors",a)}}};var F=function(){var t=this,e=t._self._c;return e("div",{staticClass:"u-spacingBottom _form-team"},[e("div",{staticClass:"u-spacingBottom"},[e("DLabel",{attrs:{str:t.$t("archiving_community")}}),e("DestinationCorpusSelector",{attrs:{selected_destination_folder_path:t.local_destination_folder_path},on:{"update:selected_destination_folder_path":function(s){t.local_destination_folder_path=s}}})],1),e("AuthorField",{attrs:{label:t.$t("authors"),instructions:t.$t("media_editing_instructions"),authors_paths:t.authors,can_edit:!0},on:{save:t.onAuthorsChange}})],1)},D=[],R=n(T,F,D,!1,null,"0508574d");const B=R.exports,A={name:"MediastackStepReview",components:{KeywordsField:l},props:{title:{type:String,default:""},description:{type:String,default:""},keywords:{type:Array,default:()=>[]}}};var K=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_form-review"},[e("div",{staticClass:"u-spacingBottom"},[e("DLabel",{attrs:{str:t.$t("title")}}),e("h2",[t._v(" "+t._s(t.title||t.$t("none"))+" ")])],1),e("div",{staticClass:"u-spacingBottom"},[e("DLabel",{attrs:{str:t.$t("description")}}),e("div",{domProps:{innerHTML:t._s(t.description||t.$t("none_f"))}})],1),e("div",{staticClass:"u-spacingBottom"},[e("DLabel",{attrs:{str:t.$t("keywords")}}),t.keywords.length>0?e("div",[e("KeywordsField",{attrs:{keywords:t.keywords,can_edit:!1}})],1):e("div",[t._v(t._s(t.$t("none")))])],1)])},G=[],I=n(A,K,G,!1,null,"7ec6c113");const P=I.exports,L={props:{selected_items:Array},components:{ChutierItem:c,MediastackStepTitle:v,MediastackStepCredits:C,MediastackStepKeywords:x,MediastackStepAuthors:B,MediastackStepReview:P},data(){return{current_step:0,steps:[{label:this.$t("title")},{label:this.$t("keywords")},{label:this.$t("credits")},{label:this.$t("team")},{label:this.$t("review")}],stack_title:"",has_valid_title:!1,stack_description:"",stack_common_credit:"",stack_general_credit:"",stack_tags:[],stack_authors:[],status:"idle",selected_destination_folder_path:void 0}},created(){this.connected_as.$path&&this.stack_authors.push(this.connected_as.$path)},mounted(){},beforeDestroy(){},watch:{},computed:{modal_name(){return this.$t("create_document")},allow_next_step(){return this.current_step===0?this.has_valid_title:this.current_step===2?this.stack_tags.length>0:!0},show_only_thumbs(){return this.current_step>0&&this.current_step!==4}},methods:{backStep(){this.current_step>0?this.current_step--:this.$emit("close")},async nextStep(){this.current_step===1&&this.stack_general_credit&&await this.applyGeneralCreditToItems(),this.current_step++},async applyGeneralCreditToItems(){for(const a of this.selected_items)if(!a.$credits||a.$credits.trim()==="")try{await this.$api.updateMeta({path:a.$path,new_meta:{$credits:this.stack_general_credit}}),a.$credits=this.stack_general_credit}catch(t){console.error(`Failed to update credit for ${a.$path}:`,t)}},async publishMediastack(){this.status="publishing";const a=this.selected_destination_folder_path+"/stacks";let t={$status:"public",requested_slug:"stack",$admins:this.stack_authors,title:this.stack_title,description:this.stack_description,keywords:this.stack_tags};const e=await this.$api.createFolder({path:a,additional_meta:t}),s=a+"/"+e;let i=[];for(const r of this.selected_items){const _=await this.$api.copyFile({path:r.$path,path_to_destination_folder:s,new_meta:{}});i.push(_),await this.$api.deleteItem({path:r.$path})}let o={stack_files_metas:i};i.length>=1&&(o.$preview=i[0]),await this.$api.updateMeta({path:s,new_meta:o}),await new Promise(r=>setTimeout(r,250)),this.status="completed",this.$emit("stackPosted",e),await new Promise(r=>setTimeout(r,1e3)),this.$emit("close")}}};var N=function(){var t=this,e=t._self._c;return e("BaseModal2",{attrs:{size:"small",confirm_before_closing:!0},on:{save:function(s){},close:function(s){return t.$emit("close")}},scopedSlots:t._u([{key:"footer",fn:function(){return[e("div",[t.status==="idle"?e("button",{staticClass:"u-button u-button_transparent",on:{click:t.backStep}},[e("b-icon",{attrs:{icon:"arrow-left"}}),t._v(" "+t._s(t.$t("back"))+" ")],1):t._e()]),t.current_step<t.steps.length-1?e("button",{staticClass:"u-button",attrs:{disabled:!t.allow_next_step},on:{click:t.nextStep}},[t._v(" "+t._s(t.$t("next"))+" "),e("b-icon",{attrs:{icon:"arrow-right"}})],1):t.current_step===t.steps.length-1&&t.status==="idle"?e("button",{staticClass:"u-button",attrs:{disabled:!t.selected_destination_folder_path},on:{click:t.publishMediastack}},[t._v(" "+t._s(t.$t("publish"))+" ")]):t.status==="publishing"?e("span",[t._v(" "+t._s(t.$t("publishing"))+" ")]):t.status==="completed"?e("span",[t._v(" "+t._s(t.$t("completed"))+" ")]):t._e(),t.allow_next_step?t._e():e("div",{staticClass:"u-instructions _cantNextInstr"},[t.current_step===0?[t._v(" "+t._s(t.$t("add_title_to_continue"))+" ")]:t._e(),t.current_step===2?[t._v(" "+t._s(t.$t("add_keywords_to_continue"))+" ")]:t._e(),t.current_step===3?[t._v(" "+t._s(t.$t("add_authors_to_continue"))+" ")]:t._e()],2)]},proxy:!0}])},[e("div",{staticClass:"_createNewMediastackModal"},[e("portal-target",{attrs:{name:"largemedia",multiple:""}}),e("div",{staticClass:"_content"},[e("div",{staticClass:"_breadcrumb"},t._l(t.steps,function(s,i){return e("button",{key:s.label,staticClass:"step",class:t.current_step===i?"active":t.current_step>i?"completed":"",attrs:{type:"button"},on:{click:function(o){t.current_step=i}}},[i>0?e("div",{staticClass:"step-line"}):t._e(),e("div",{staticClass:"step-circle"})])}),0),e("transition",{attrs:{name:"fade",mode:"out-in"}},[e("div",{key:t.current_step,staticClass:"_form"},[t._e(),t.current_step===0?e("MediastackStepTitle",{attrs:{title:t.stack_title,description:t.stack_description},on:{"update:title":function(s){t.stack_title=s},"update:description":function(s){t.stack_description=s},"title-validity-changed":function(s){t.has_valid_title=s}},scopedSlots:t._u([{key:"uptop",fn:function(){return[e("div",{staticClass:"_uptopThumbs"},[t.selected_items&&t.selected_items.length?e("div",{staticClass:"_thumbGrid"},t._l(t.selected_items,function(s){return e("ChutierItem",{key:s.$path,staticClass:"_thumbCell",attrs:{file:s,context:"show_only_thumbs",is_selected:!1}})}),1):t._e()])]},proxy:!0}],null,!1,646810637)}):t._e(),t.current_step===1?e("MediastackStepCredits",{attrs:{selected_items:t.selected_items,general_credit:t.stack_general_credit},on:{"update:general_credit":function(s){t.stack_general_credit=s}}}):t._e(),t.current_step===2?e("MediastackStepKeywords",{attrs:{keywords:t.stack_tags},on:{"update:keywords":function(s){t.stack_tags=s}}}):t._e(),t.current_step===3?e("MediastackStepAuthors",{attrs:{authors:t.stack_authors,destination_folder_path:t.selected_destination_folder_path},on:{"update:authors":function(s){t.stack_authors=s},"update:destination_folder_path":function(s){t.selected_destination_folder_path=s}}}):t._e(),t.current_step===4?e("MediastackStepReview",{attrs:{title:t.stack_title,description:t.stack_description,keywords:t.stack_tags}}):t._e()],1)])],1)],1)])},O=[],Q=n(L,N,O,!1,null,"e97453db");const U=Q.exports;export{U as default};
