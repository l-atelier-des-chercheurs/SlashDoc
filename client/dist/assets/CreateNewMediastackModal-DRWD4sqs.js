import{C as c}from"./ContributeView-CtoK6knq.js";import{n as o,_ as l}from"../build.js";import{a as d,K as u}from"./KeywordsField-Ckq-W3DH.js";import{D as p}from"./DestinationCorpusSelector-CGRsgme7.js";import"./EmbedPicker-D-ofHmFh.js";import"./TwoColumnLayout-DsthKvhd.js";const h={name:"MediastackStepTitle",props:{title:{type:String,default:""},description:{type:String,default:""},selected_items:{type:Array,default:()=>[]},location:{type:Object,default:()=>null}},components:{PositionPicker:()=>l(()=>import("./PositionPicker-CXwaVC6C.js"),[])},computed:{available_locations(){if(!this.selected_items||this.selected_items.length===0)return[];const s=new Map;for(const t of this.selected_items)if(t.$location&&t.$location.latitude&&t.$location.longitude){const e=`${t.$location.latitude.toFixed(6)},${t.$location.longitude.toFixed(6)}`;s.has(e)||s.set(e,{latitude:t.$location.latitude,longitude:t.$location.longitude,zoom:t.$location.zoom||2})}return Array.from(s.values())}},methods:{onTitleChange(s){this.$emit("update:title",s)},onDescriptionChange(s){this.$emit("update:description",s)},onTitleValidityChange(s){this.$emit("title-validity-changed",s)},onLocationChange(s){this.$emit("update:location",s)},selectLocation(s){this.onLocationChange(s)},formatLocation(s){return!s||!s.latitude||!s.longitude?"":`${s.latitude.toFixed(4)}, ${s.longitude.toFixed(4)}`}}};var m=function(){var t=this,e=t._self._c;return e("div",[t._t("uptop"),e("div",{staticClass:"u-spacingBottom"}),e("div",{staticClass:"_form-title"},[e("div",{staticClass:"u-spacingBottom"},[e("DLabel",{attrs:{str:t.$t("title")}}),e("TextInput",{attrs:{content:t.title,required:!0,placeholder:t.$t("document_title"),autofocus:!0,can_edit:!0},on:{"update:content":t.onTitleChange,toggleValidity:t.onTitleValidityChange}})],1),e("div",{staticClass:"u-spacingBottom _description"},[e("DLabel",{attrs:{str:t.$t("description")}}),e("TextInput",{attrs:{content:t.description,input_type:"editor",placeholder:t.$t("description_placeholder"),can_edit:!0},on:{"update:content":t.onDescriptionChange}})],1),e("div",{staticClass:"u-spacingBottom _position"},[e("PositionPicker",{attrs:{label:t.$t("location"),can_edit:!0,content:t.location},on:{newPosition:t.onLocationChange}}),t.available_locations.length>0?e("div",{staticClass:"_locationButtons"},[e("div",{staticClass:"u-instructions"},[t._v(" "+t._s(t.$t("use_location_from_media"))+" ")]),e("div",{staticClass:"_locationButtonsList"},t._l(t.available_locations,function(a,i){return e("button",{key:i,staticClass:"u-button u-button_small u-button_transparent",attrs:{type:"button"},on:{click:function(r){return t.selectLocation(a)}}},[e("b-icon",{attrs:{icon:"geo-alt"}}),t._v(" "+t._s(t.formatLocation(a))+" ")],1)}),0)]):t._e()],1)])],2)},f=[],v=o(h,m,f,!1,null,"d0d72998");const $=v.exports,g={name:"MediastackStepCredits",props:{selected_items:{type:Array,default:()=>[]},general_credit:{type:String,default:""}},computed:{local_general_credit:{get(){return this.general_credit},set(s){this.$emit("update:general_credit",s)}}},components:{ChutierItem:c},methods:{}};var k=function(){var t=this,e=t._self._c;return e("div",{staticClass:"u-spacingBottom _form-credits"},[e("DLabel",{staticClass:"_label",attrs:{str:t.$t("general_credit"),icon_name:"c-circle"}}),e("div",{staticClass:"u-instructions"},[e("small",[t._v(" "+t._s(t.$t("general_credit_instructions"))+" ")])]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.local_general_credit,expression:"local_general_credit"}],attrs:{type:"text",autofocus:""},domProps:{value:t.local_general_credit},on:{input:function(a){a.target.composing||(t.local_general_credit=a.target.value)}}}),e("div",{staticClass:"u-spacingBottom"}),t.selected_items&&t.selected_items.length?e("div",{staticClass:"_thumbGrid"},t._l(t.selected_items,function(a){return e("ChutierItem",{key:a.$path,staticClass:"_thumbCell",attrs:{file:a,credit_placeholder:t.local_general_credit,is_selected:!1,context:"credits"}})}),1):t._e()],1)},y=[],b=o(g,k,y,!1,null,"4d336a57");const C=b.exports,w={name:"MediastackStepKeywords",components:{KeywordsFieldEditor:d},props:{keywords:{type:Array,default:()=>[]}},methods:{onKeywordsChange(s){this.$emit("update:keywords",s)}}};var S=function(){var t=this,e=t._self._c;return e("div",{staticClass:"u-spacingBottom _form-tags"},[e("KeywordsFieldEditor",{attrs:{keywords:t.keywords},on:{"update:keywords":t.onKeywordsChange}})],1)},M=[],x=o(w,S,M,!1,null,"76c0f3dd");const T=x.exports,F={name:"MediastackStepAuthors",components:{DestinationCorpusSelector:p},props:{authors:{type:Array,default:()=>[]},destination_folder_path:{type:[String,void 0],default:void 0}},data(){return{local_destination_folder_path:this.destination_folder_path}},watch:{destination_folder_path:{immediate:!0,handler(s){this.local_destination_folder_path=s}},local_destination_folder_path(s){this.$emit("update:destination_folder_path",s)}},methods:{onAuthorsChange(s){this.$emit("update:authors",s)}}};var L=function(){var t=this,e=t._self._c;return e("div",{staticClass:"u-spacingBottom _form-team"},[e("div",{staticClass:"u-spacingBottom"},[e("DLabel",{attrs:{str:t.$t("archiving_community")}}),e("DestinationCorpusSelector",{attrs:{selected_destination_folder_path:t.local_destination_folder_path},on:{"update:selected_destination_folder_path":function(a){t.local_destination_folder_path=a}}})],1),e("AuthorField",{attrs:{label:t.$t("authors"),instructions:t.$t("content_editing_instructions"),authors_paths:t.authors,disable_links:!0,can_edit:!0},on:{save:t.onAuthorsChange}})],1)},A=[],B=o(F,L,A,!1,null,"58e23159");const D=B.exports,P={name:"MediastackStepReview",components:{KeywordsField:u,PositionPicker:()=>l(()=>import("./PositionPicker-CXwaVC6C.js"),[])},props:{title:{type:String,default:""},description:{type:String,default:""},keywords:{type:Array,default:()=>[]},selected_destination_folder_path:{type:String,default:""},authors:{type:Array,default:()=>[]},location:{type:Object,default:()=>null}},data(){return{selected_folder:null}},async created(){this.selected_destination_folder_path&&(this.selected_folder=await this.$api.getFolder({path:this.selected_destination_folder_path}))}};var R=function(){var t=this,e=t._self._c;return e("div",{staticClass:"_form-review"},[e("div",{staticClass:"u-spacingBottom"},[e("h1",[t._v(" "+t._s(t.title||t.$t("none"))+" ")])]),e("div",{staticClass:"u-spacingBottom"},[e("DLabel",{attrs:{str:t.$t("description")}}),e("div",{domProps:{innerHTML:t._s(t.description||t.$t("none_f"))}})],1),e("div",{staticClass:"u-spacingBottom"},[e("DLabel",{attrs:{str:t.$t("keywords")}}),t.keywords.length>0?e("div",[e("KeywordsField",{attrs:{keywords:t.keywords,can_edit:!1}})],1):e("div",[t._v(t._s(t.$t("none")))])],1),e("div",{staticClass:"u-spacingBottom"},[e("DLabel",{attrs:{str:t.$t("location")}}),t.location&&t.location.latitude&&t.location.longitude?e("div",[e("PositionPicker",{attrs:{content:t.location,can_edit:!1}})],1):e("div",[t._v(t._s(t.$t("none")))])],1),e("div",{staticClass:"u-spacingBottom"},[e("DLabel",{attrs:{str:t.$t("destination_corpus")}}),t.selected_folder?e("b",[t._v(" "+t._s(t.selected_folder.title)+" ")]):e("div",[t._v(t._s(t.$t("none")))])],1),e("div",{},[e("DLabel",{attrs:{str:t.$t("authors")}}),t.authors.length>0?e("div",[e("AuthorField",{attrs:{authors_paths:t.authors,disable_links:!0,can_edit:!1}})],1):e("div",[t._v(t._s(t.$t("none")))])],1)])},I=[],K=o(P,R,I,!1,null,"f74547c8");const V=K.exports,z={props:{selected_items:Array},components:{ChutierItem:c,MediastackStepTitle:$,MediastackStepCredits:C,MediastackStepKeywords:T,MediastackStepAuthors:D,MediastackStepReview:V},data(){return{current_step:0,steps:[{label:this.$t("title")},{label:this.$t("credit")},{label:this.$t("keywords")},{label:this.$t("archiving_community")},{label:this.$t("review")}],stack_title:"",has_valid_title:!1,stack_description:"",stack_common_credit:"",stack_general_credit:"",stack_tags:[],stack_authors:[],stack_location:null,status:"idle",selected_destination_folder_path:void 0}},created(){this.connected_as.$path&&this.stack_authors.push(this.connected_as.$path)},mounted(){},beforeDestroy(){},watch:{},computed:{modal_size(){return this.current_step===2?"full":"small"},modal_name(){return this.$t("create_document")},allow_next_step(){return this.current_step===0?this.has_valid_title:this.current_step===2?this.stack_tags.length>0:!0},show_only_thumbs(){return this.current_step>0&&this.current_step!==4}},methods:{backStep(){this.current_step>0?this.current_step--:this.$emit("close")},async nextStep(){this.current_step===1&&this.stack_general_credit&&await this.applyGeneralCreditToItems(),this.current_step++},async applyGeneralCreditToItems(){for(const s of this.selected_items)if(!s.$credits||s.$credits.trim()==="")try{await this.$api.updateMeta({path:s.$path,new_meta:{$credits:this.stack_general_credit}}),s.$credits=this.stack_general_credit}catch(t){console.error(`Failed to update credit for ${s.$path}:`,t)}},async publishMediastack(){this.status="publishing";const s=this.selected_destination_folder_path+"/stacks";let t={$status:"public",requested_slug:"stack",$admins:this.stack_authors,title:this.stack_title,description:this.stack_description,keywords:this.stack_tags};this.stack_location&&this.stack_location.latitude&&this.stack_location.longitude&&(t.$location=this.stack_location);const e=await this.$api.createFolder({path:s,additional_meta:t}),a=s+"/"+e;let i=[];for(const n of this.selected_items){const _=await this.$api.copyFile({path:n.$path,path_to_destination_folder:a,new_meta:{}});i.push(_),await this.$api.deleteItem({path:n.$path})}let r={stack_files_metas:i};i.length>=1&&(r.$preview=i[0]),await this.$api.updateMeta({path:a,new_meta:r}),await new Promise(n=>setTimeout(n,250)),this.status="completed",this.$emit("stackPosted",e),await new Promise(n=>setTimeout(n,1e3)),this.$emit("close")}}};var E=function(){var t=this,e=t._self._c;return e("BaseModal2",{attrs:{size:t.modal_size,confirm_before_closing:!0,title:t.current_step===4?t.$t("review"):void 0},on:{close:function(a){return t.$emit("close")}},scopedSlots:t._u([{key:"footer",fn:function(){return[e("div",[t.status==="idle"?e("button",{staticClass:"u-button u-button_transparent",on:{click:t.backStep}},[e("b-icon",{attrs:{icon:"arrow-left"}}),t._v(" "+t._s(t.$t("back"))+" ")],1):t._e()]),t.current_step<t.steps.length-1?e("button",{staticClass:"u-button",attrs:{disabled:!t.allow_next_step},on:{click:t.nextStep}},[t._v(" "+t._s(t.$t("next"))+" "),e("b-icon",{attrs:{icon:"arrow-right"}})],1):t.current_step===t.steps.length-1&&t.status==="idle"?e("button",{staticClass:"u-button u-button_bleuvert",on:{click:t.publishMediastack}},[e("b-icon",{attrs:{icon:"check-circle-fill"}}),t._v(" "+t._s(t.$t("contribute"))+" ")],1):t.status==="publishing"?e("span",[t._v(" "+t._s(t.$t("publishing"))+" ")]):t.status==="completed"?e("span",[t._v(" "+t._s(t.$t("completed"))+" ")]):t._e(),t.allow_next_step?t._e():e("div",{staticClass:"u-instructions _cantNextInstr"},[t.current_step===0?[t._v(" "+t._s(t.$t("add_title_to_continue"))+" ")]:t._e(),t.current_step===2?[t._v(" "+t._s(t.$t("add_keywords_to_continue"))+" ")]:t._e(),t.current_step===3?[t._v(" "+t._s(t.$t("add_authors_to_continue"))+" ")]:t._e()],2)]},proxy:!0}])},[e("div",{staticClass:"_createNewMediastackModal"},[e("portal-target",{attrs:{name:"largemedia",multiple:""}}),e("div",{staticClass:"_content"},[t.current_step<4?e("div",{staticClass:"_breadcrumb"},t._l(t.steps,function(a,i){return e("button",{key:a.label,staticClass:"step",class:t.current_step===i?"active":t.current_step>i?"completed":"",attrs:{type:"button",title:a.label},on:{click:function(r){t.current_step=i}}},[i>0?e("div",{staticClass:"step-line"}):t._e(),e("div",{staticClass:"step-circle"},[t.current_step>=i?e("div",{staticClass:"step-label"},[t._v(" "+t._s(a.label)+" ")]):t._e()])])}),0):t._e(),e("div",{key:t.current_step,staticClass:"_form"},[t._e(),[0,2,3,4].includes(t.current_step)?e("div",{staticClass:"_uptopThumbs"},[t.selected_items&&t.selected_items.length?e("div",{staticClass:"_thumbGrid"},t._l(t.selected_items,function(a){return e("ChutierItem",{key:a.$path,staticClass:"_thumbCell",attrs:{file:a,context:"show_only_thumbs",is_selected:!1}})}),1):t._e()]):t._e(),t.current_step===0?e("MediastackStepTitle",{attrs:{title:t.stack_title,description:t.stack_description,selected_items:t.selected_items,location:t.stack_location},on:{"update:title":function(a){t.stack_title=a},"update:description":function(a){t.stack_description=a},"update:location":function(a){t.stack_location=a},"title-validity-changed":function(a){t.has_valid_title=a}}}):t._e(),t.current_step===1?e("MediastackStepCredits",{attrs:{selected_items:t.selected_items,general_credit:t.stack_general_credit},on:{"update:general_credit":function(a){t.stack_general_credit=a}}}):t._e(),t.current_step===2?e("MediastackStepKeywords",{attrs:{keywords:t.stack_tags},on:{"update:keywords":function(a){t.stack_tags=a}}}):t._e(),t.current_step===3?e("MediastackStepAuthors",{attrs:{authors:t.stack_authors,destination_folder_path:t.selected_destination_folder_path},on:{"update:authors":function(a){t.stack_authors=a},"update:destination_folder_path":function(a){t.selected_destination_folder_path=a}}}):t._e(),t.current_step===4?e("MediastackStepReview",{attrs:{title:t.stack_title,description:t.stack_description,keywords:t.stack_tags,selected_destination_folder_path:t.selected_destination_folder_path,authors:t.stack_authors,location:t.stack_location}}):t._e()],1)])],1)])},G=[],N=o(z,E,G,!1,null,"f2da3add");const X=N.exports;export{X as default};
