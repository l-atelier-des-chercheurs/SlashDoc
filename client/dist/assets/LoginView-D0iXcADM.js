import{n,_ as a}from"../build.js";const i={components:{RecoverPasswordModal:()=>a(()=>import("./RecoverPasswordModal-BMR61Suw.js"),[])},data(){return{authors:[],search_author_name:"",debounced_search_author_name:"",debounce_timeout:null,debouncing_search_author_name:!1,author_to_login_to:void 0,input_password:"",show_recover_modal:!1,connection_status:void 0,msg_password_is_wrong:void 0,allow_save:!1}},created(){},async mounted(){if(this.connected_as){this.$router.replace("/");return}this.$eventHub.$on("login.suggest",this.checkAuthor),this.authors=await this.$api.getFolders({path:"authors"})},beforeDestroy(){this.$eventHub.$off("login.suggest",this.checkAuthor),this.debounce_timeout&&clearTimeout(this.debounce_timeout)},watch:{search_author_name(o){if(this.debounce_timeout&&clearTimeout(this.debounce_timeout),o.length===0){this.debounced_search_author_name="",this.debouncing_search_author_name=!1;return}this.debouncing_search_author_name=!0,this.debounce_timeout=setTimeout(()=>{this.debounced_search_author_name=o,this.debouncing_search_author_name=!1},500)}},computed:{author_suggestions(){return this.debounced_search_author_name.length===0||this.authors.length===0?!1:this.authors.filter(t=>this.twoStringsSearch(t.name,this.debounced_search_author_name)).map(t=>t.$path).slice(0,5)}},methods:{setFirstSuggestion(){this.author_suggestions&&this.author_suggestions.length>0&&this.checkAuthor(this.author_suggestions[0])},async login(){this.connection_status="pending";const o=this.author_to_login_to;if(!o){this.$refs.name_field.$el.querySelector("input").focus(),this.$alertify.delay(4e3).error(this.$t("account_doesnt_exist")),this.connection_status=void 0;return}const t=o.$path;this.$api.loginToFolder({path:t,password:this.input_password}).then(()=>{this.$alertify.delay(4e3).success(this.$t("logged_in")),this.connection_status="success",setTimeout(()=>{window.location.reload()},500)}).catch(s=>{this.connection_status="failed",s.code==="submitted_password_is_wrong"&&(this.$refs.password_field.$el.querySelector("input").focus(),this.msg_password_is_wrong=this.$t("submitted_password_is_wrong"),setTimeout(()=>{this.msg_password_is_wrong=void 0},3500)),this.connection_status=void 0})},checkAuthor(o){const t=this.authors.find(s=>s.$path===o);this.search_author_name="",this.author_to_login_to=t}}};var r=function(){var t=this,s=t._self._c;return s("div",{staticClass:"_loginView"},[s("div",{staticClass:"_loginView--content"},[s("h1",[t._v(t._s(t.$t("connect")))]),t.connected_as?t._e():s("form",{on:{submit:function(e){return e.preventDefault(),t.login.apply(null,arguments)}}},[s("transition",{attrs:{name:"pagechange",mode:"out-in"}},[t.author_to_login_to?s("div",{key:"login"},[s("div",{staticClass:"u-spacingBottom"},[s("AuthorTag",{key:t.author_to_login_to.$path,attrs:{path:t.author_to_login_to.$path}})],1),s("div",{staticClass:"u-spacingBottom"},[s("TextInput",{ref:"password_field",attrs:{label_str:"password",content:t.input_password,required:!0,autofocus:!0,input_type:"password",autocomplete:"current-password"},on:{"update:content":function(e){t.input_password=e},toggleValidity:function(e){t.allow_save=e},onEnter:t.login}})],1),s("button",{staticClass:"u-buttonLink",class:{"is--active":t.show_recover_modal},attrs:{type:"button"},on:{click:function(e){t.show_recover_modal=!0}}},[t._v(" "+t._s(t.$t("recover_password"))+" ")]),t.show_recover_modal?s("RecoverPasswordModal",{attrs:{author:t.author_to_login_to},on:{close:function(e){t.show_recover_modal=!1}}}):t._e(),t.msg_password_is_wrong?s("div",{staticClass:"u-warning u-spacingBottom"},[t._v(" "+t._s(t.msg_password_is_wrong)+" ")]):t._e(),s("div",{staticClass:"u-spacingBottom"}),s("div",{staticClass:"_loginView--buttons"},[s("button",{staticClass:"u-buttonLink",attrs:{type:"button"},on:{click:function(e){t.author_to_login_to=void 0}}},[s("b-icon",{attrs:{icon:"arrow-left-short"}}),t._v(" "+t._s(t.$t("back"))+" ")],1),s("button",{staticClass:"u-button u-button_bleuvert",attrs:{type:"submit",disabled:t.connection_status==="pending"}},[t.connection_status==="pending"?s("LoaderSpinner"):[t._v(t._s(t.$t("login")))]],2)])],1):s("div",{key:"search"},[s("transition",{attrs:{name:"pagechange",mode:"out-in"}},[t.author_suggestions===!1&&!t.debouncing_search_author_name?s("div",{key:"none"}):t.author_suggestions.length===0&&!t.debouncing_search_author_name?s("div",{key:"no_author",staticClass:"u-instructions u-spacingBottom"},[s("b-icon",{attrs:{icon:"exclamation-triangle-fill"}}),t._v(" "+t._s(t.$t("login_no_account_matches"))+" ")],1):t.author_suggestions.length>0?s("div",{key:"list",staticClass:"u-spacingBottom u-listOfAvatars"},t._l(t.author_suggestions,function(e){return s("AuthorTag",{key:e,attrs:{path:e,mode:"select"},on:{click:function(c){return t.checkAuthor(e)}}})}),1):t._e(),t.debouncing_search_author_name?s("div",{key:"debouncing",staticClass:"u-instructions u-spacingBottom"},[s("span",{staticClass:"_blinking-dots"},[t._v("â€¦")])]):t._e()]),s("div",{staticClass:"u-spacingBottom"},[s("TextInput",{ref:"name_field",attrs:{content:t.search_author_name,label_str:"name_or_pseudonym",required:!0,autofocus:!0,input_type:"text",autocomplete:"username"},on:{"update:content":function(e){t.search_author_name=e},toggleValidity:function(e){t.allow_save=e},onEnter:t.setFirstSuggestion}})],1)],1)])],1),t.author_to_login_to?t._e():[s("hr",{staticClass:"_loginView--separator"}),s("div",{staticClass:"_loginView--footer"},[s("p",{staticClass:"_loginView--footer-text"},[t._v(t._s(t.$t("not_yet_registered")))]),s("router-link",{staticClass:"u-button u-button_outline",attrs:{to:"/login/create"}},[t._v(" "+t._s(t.$t("create_account"))+" ")])],1),t.authors.length===0?s("p",{staticClass:"u-instructions"},[s("small",[t._v(t._s(t.$t("no_accounts_yet")))])]):t._e()]],2)])},u=[],_=n(i,r,u,!1,null,"fb815453");const l=_.exports;export{l as default};
